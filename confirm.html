<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Confirm Order — SnapEats</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/css/styles.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg px-4">
    <a class="navbar-brand" href="index.html">SnapEats</a>
  </nav>

  <main class="container py-4">
    <h3 class="section-title">Order Confirmation</h3>
    <div class="row">
      <div class="col-md-7">
        <div class="card p-3">
          <h5>Pickup Details</h5>
          <form id="confirmForm" onsubmit="event.preventDefault(); placeOrder();">
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input required class="form-control" id="custName">
            </div>
            <div class="mb-3">
              <label class="form-label">Phone</label>
              <input required class="form-control" id="custPhone">
            </div>
            <div class="mb-3">
              <label class="form-label">Pickup time (approx)</label>
              <input required type="datetime-local" class="form-control" id="pickupTime">
            </div>
            <button class="btn btn-success">Confirm Order</button>
          </form>
        </div>
      </div>
      <div class="col-md-5">
        <div class="card p-3">
          <h5>Order Summary</h5>
          <div id="summaryArea"></div>
        </div>
      </div>
    </div>
  </main>

  <script src="assets/js/script.js"></script>
  <script>
    function renderSummary(){
      const t = cartTotals();
      const cart = loadCart();
      const area = document.querySelector('#summaryArea');
      let html = `<ul class="list-unstyled small">`;
      cart.forEach(it => html += `<li>${it.qty} x ${it.name} — LKR ${it.price * it.qty}</li>`);
      html += `</ul><hr><p>Subtotal: LKR ${t.subtotal}</p><p>Tax: LKR ${t.tax}</p><h5>Total: LKR ${t.total}</h5>`;
      area.innerHTML = html;
    }
    function placeOrder(){
      // mock: save simple order and redirect to tracking with order id
      const name = document.getElementById('custName').value;
      const phone = document.getElementById('custPhone').value;
      const pickup = document.getElementById('pickupTime').value;
      if(!name||!phone||!pickup) return showToast('Please fill all fields');
      // create a simple order object
      const order = {
        id: 'ORD' + Math.floor(Math.random()*100000),
        items: loadCart(),
        total: cartTotals().total,
        name, phone, pickup,
        status: 'Preparing',
        createdAt: new Date().toISOString()
      };
      // store in localStorage 'snapEats_orders'
      const orders = JSON.parse(localStorage.getItem('snapEats_orders') || '[]');
      orders.push(order);
      localStorage.setItem('snapEats_orders', JSON.stringify(orders));
      clearCart();
      showToast('Order placed! Redirecting to tracking');
      setTimeout(()=> location.href = `track.html?orderId=${order.id}`, 800);
    }
    document.addEventListener('DOMContentLoaded', ()=> renderSummary());
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
